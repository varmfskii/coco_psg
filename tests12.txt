                      (      tests12.asm):00001                 include "inc/coco.inc"
                      (     inc/coco.inc):00001                 ifndef coco_inc
     0001             (     inc/coco.inc):00002         coco_inc: equ 1
     010C             (     inc/coco.inc):00003         irqvec: equ $010c
     0400             (     inc/coco.inc):00004         screen: equ $0400
     FF00             (     inc/coco.inc):00005         pia0:   equ $ff00
     FF20             (     inc/coco.inc):00006         pia1:   equ $ff20
     FF7F             (     inc/coco.inc):00007         mpi:    equ $ff7f
                      (     inc/coco.inc):00008         
0000                  (     inc/coco.inc):00009         cart_snd macro
                      (     inc/coco.inc):00010                 ;; sound mux to cart
                      (     inc/coco.inc):00011                 lda pia0+1
                      (     inc/coco.inc):00012                 anda #%11110111
                      (     inc/coco.inc):00013                 sta pia0+1
                      (     inc/coco.inc):00014                 lda pia0+3
                      (     inc/coco.inc):00015                 ora #%00001000
                      (     inc/coco.inc):00016                 sta pia0+3
                      (     inc/coco.inc):00017                 ;; enable sound
                      (     inc/coco.inc):00018                 lda pia1+3
                      (     inc/coco.inc):00019                 ora #%00001000
                      (     inc/coco.inc):00020                 sta pia1+3
                      (     inc/coco.inc):00021                 endm
                      (     inc/coco.inc):00022                 endif
                      (      tests12.asm):00002                 include "inc/aypsg.inc"
                      (    inc/aypsg.inc):00001                 ifndef aypsg_inc
     0001             (    inc/aypsg.inc):00002         ay_psg_inc:  equ 1
     0000             (    inc/aypsg.inc):00003         ay_a_fine:   equ 0
     0001             (    inc/aypsg.inc):00004         ay_a_coarse: equ 1
     0002             (    inc/aypsg.inc):00005         ay_b_fine:   equ 2
     0003             (    inc/aypsg.inc):00006         ay_b_coarse: equ 3
     0004             (    inc/aypsg.inc):00007         ay_c_fine:   equ 4
     0005             (    inc/aypsg.inc):00008         ay_c_coarse: equ 5
     0006             (    inc/aypsg.inc):00009         ay_noise:    equ 6
     0007             (    inc/aypsg.inc):00010         ay_enable:   equ 7
     0008             (    inc/aypsg.inc):00011         ay_a_amp:    equ 8
     0009             (    inc/aypsg.inc):00012         ay_b_amp:    equ 9
     000A             (    inc/aypsg.inc):00013         ay_c_amp:    equ 10
     000B             (    inc/aypsg.inc):00014         ay_e_fine:   equ 11
     000C             (    inc/aypsg.inc):00015         ay_e_coarse: equ 12
     000D             (    inc/aypsg.inc):00016         ay_e_shape:  equ 13
                      (    inc/aypsg.inc):00017                 endif
                      (      tests12.asm):00003         
                      (      tests12.asm):00004                 org $7000
                      (      tests12.asm):00005                 include "s12.asm"
     0003             (          s12.asm):00001         psg1:   equ $03
     000C             (          s12.asm):00002         psg2:   equ $0c
     0030             (          s12.asm):00003         psg3:   equ $30
     00C0             (          s12.asm):00004         psg4:   equ $c0
     00AA             (          s12.asm):00005         s12_dat: equ $aa        
     00FF             (          s12.asm):00006         s12_reg: equ $ff
     FF60             (          s12.asm):00007         dat_a:  equ $ff60
     FF61             (          s12.asm):00008         ctl_a:  equ $ff61
     FF62             (          s12.asm):00009         dat_b:  equ $ff62
     FF63             (          s12.asm):00010         ctl_b:  equ $ff63
                      (          s12.asm):00011         
7000                  (          s12.asm):00012         s12_pre macro
                      (          s12.asm):00013                 clra
                      (          s12.asm):00014                 sta ctl_a
                      (          s12.asm):00015                 sta ctl_b
                      (          s12.asm):00016                 lda #$ff
                      (          s12.asm):00017                 sta dat_a
                      (          s12.asm):00018                 sta dat_b
                      (          s12.asm):00019                 lda #$04
                      (          s12.asm):00020                 sta ctl_a
                      (          s12.asm):00021                 sta ctl_b
                      (          s12.asm):00022                 clra
                      (          s12.asm):00023                 sta dat_a
                      (          s12.asm):00024                 sta dat_b
                      (          s12.asm):00025                 endm
                      (          s12.asm):00026                 
7000                  (          s12.asm):00027         s12_post macro
                      (          s12.asm):00028                 endm
                      (          s12.asm):00029                 
7000                  (          s12.asm):00030         s12_init:
                      (          s12.asm):00031                 cart_snd
                      (         cart_snd):00001                 ;; sound mux to cart
7000 B6FF01           (         cart_snd):00002                 lda pia0+1
7003 84F7             (         cart_snd):00003                 anda #%11110111
7005 B7FF01           (         cart_snd):00004                 sta pia0+1
7008 B6FF03           (         cart_snd):00005                 lda pia0+3
700B 8A08             (         cart_snd):00006                 ora #%00001000
700D B7FF03           (         cart_snd):00007                 sta pia0+3
                      (         cart_snd):00008                 ;; enable sound
7010 B6FF23           (         cart_snd):00009                 lda pia1+3
7013 8A08             (         cart_snd):00010                 ora #%00001000
7015 B7FF23           (         cart_snd):00011                 sta pia1+3
                      (          s12.asm):00032                 s12_pre
7018 4F               (          s12_pre):00001                 clra
7019 B7FF61           (          s12_pre):00002                 sta ctl_a
701C B7FF63           (          s12_pre):00003                 sta ctl_b
701F 86FF             (          s12_pre):00004                 lda #$ff
7021 B7FF60           (          s12_pre):00005                 sta dat_a
7024 B7FF62           (          s12_pre):00006                 sta dat_b
7027 8604             (          s12_pre):00007                 lda #$04
7029 B7FF61           (          s12_pre):00008                 sta ctl_a
702C B7FF63           (          s12_pre):00009                 sta ctl_b
702F 4F               (          s12_pre):00010                 clra
7030 B7FF60           (          s12_pre):00011                 sta dat_a
7033 B7FF62           (          s12_pre):00012                 sta dat_b
7036 860D             (          s12.asm):00033                 lda #13
7038 5F               (          s12.asm):00034                 clrb
7039                  (          s12.asm):00035         loop@:
7039 B7FF60           (          s12.asm):00036                 sta dat_a
703C C6FF             (          s12.asm):00037                 ldb #s12_reg
703E F7FF62           (          s12.asm):00038                 stb dat_b
7041 7FFF62           (          s12.asm):00039                 clr dat_b
7044 7FFF60           (          s12.asm):00040                 clr dat_a
7047 C6AA             (          s12.asm):00041                 ldb #s12_dat
7049 F7FF62           (          s12.asm):00042                 stb dat_b
704C 7FFF62           (          s12.asm):00043                 clr dat_b
704F 4A               (          s12.asm):00044                 deca
7050 2AE7             (          s12.asm):00045                 bpl loop@
7052 8607             (          s12.asm):00046                 lda #ay_enable
7054 B7FF60           (          s12.asm):00047                 sta dat_a
7057 C6FF             (          s12.asm):00048                 ldb #s12_reg
7059 F7FF62           (          s12.asm):00049                 stb dat_b
705C 7FFF62           (          s12.asm):00050                 clr dat_b
705F 8638             (          s12.asm):00051                 lda #%00111000
7061 B7FF60           (          s12.asm):00052                 sta dat_a
7064 86AA             (          s12.asm):00053                 lda #s12_dat
7066 B7FF62           (          s12.asm):00054                 sta dat_b
7069 7FFF62           (          s12.asm):00055                 clr dat_b
706C 39               (          s12.asm):00056                 rts
                      (          s12.asm):00057         
706D                  (          s12.asm):00058         s12_term:       
706D 39               (          s12.asm):00059                 rts
                      (          s12.asm):00060         
706E                  (          s12.asm):00061         s12_ctl:        
706E 3426             (          s12.asm):00062                 pshs d,y
7070 10AE890002       (          s12.asm):00063                 ldy scn,x
7075 E7A6             (          s12.asm):00064                 stb a,y
7077 B7FF60           (          s12.asm):00065                 sta dat_a
707A A6890007         (          s12.asm):00066                 lda srg,x
707E B7FF62           (          s12.asm):00067                 sta dat_b
7081 7FFF62           (          s12.asm):00068                 clr dat_b
7084 F7FF60           (          s12.asm):00069                 stb dat_a
7087 A6890008         (          s12.asm):00070                 lda sdt,x
708B B7FF62           (          s12.asm):00071                 sta dat_b
708E 7FFF62           (          s12.asm):00072                 clr dat_b
7091 35A6             (          s12.asm):00073                 puls y,d,pc
7093                  (      tests12.asm):00006         start:
7093 8660             (      tests12.asm):00007                 lda #$60
7095 8E0400           (      tests12.asm):00008                 ldx #screen
7098                  (      tests12.asm):00009         cls:
7098 A780             (      tests12.asm):00010                 sta ,x+
709A 8C0600           (      tests12.asm):00011                 cmpx #screen+$200
709D 26F9             (      tests12.asm):00012                 bne cls
                      (      tests12.asm):00013         
                      (      tests12.asm):00014         ;;; initialize ay
709F 17FF5E           (      tests12.asm):00015                 lbsr s12_init
                      (      tests12.asm):00016         
                      (      tests12.asm):00017         ;;; init voices
70A2 8601             (      tests12.asm):00018                 lda #1
70A4 B771C5           (      tests12.asm):00019                 sta notdone
70A7 8E71CB           (      tests12.asm):00020                 ldx #voices
70AA 108E71F2         (      tests12.asm):00021                 ldy #scores
70AE                  (      tests12.asm):00022         loop@:
70AE ECA1             (      tests12.asm):00023                 ldd ,y++
70B0 ED89000A         (      tests12.asm):00024                 std scr,x
70B4 8601             (      tests12.asm):00025                 lda #1
70B6 A789000C         (      tests12.asm):00026                 sta cpl,x
70BA A7890009         (      tests12.asm):00027                 sta dly,x
70BE 3089000D         (      tests12.asm):00028                 leax siz,x
70C2 8C71F2           (      tests12.asm):00029                 cmpx #voiceend
70C5 26E7             (      tests12.asm):00030                 bne loop@
                      (      tests12.asm):00031                 
                      (      tests12.asm):00032         ;;; setup irq routine
70C7 1A50             (      tests12.asm):00033                 orcc #$50               ; disable interrupts
70C9 B6FF01           (      tests12.asm):00034                 lda pia0+1
70CC B771C9           (      tests12.asm):00035                 sta old+3
70CF 84FE             (      tests12.asm):00036                 anda #$fe
70D1 B7FF01           (      tests12.asm):00037                 sta pia0+1
70D4 B6FF03           (      tests12.asm):00038                 lda pia0+3
70D7 B771CA           (      tests12.asm):00039                 sta old+4
70DA 8A01             (      tests12.asm):00040                 ora #$01
70DC B7FF03           (      tests12.asm):00041                 sta pia0+3
70DF B6010C           (      tests12.asm):00042                 lda irqvec
70E2 B771C6           (      tests12.asm):00043                 sta old
70E5 867E             (      tests12.asm):00044                 lda #$7e
70E7 B7010C           (      tests12.asm):00045                 sta irqvec
70EA BE010D           (      tests12.asm):00046                 ldx irqvec+1
70ED BF71C7           (      tests12.asm):00047                 stx old+1
70F0 8E7138           (      tests12.asm):00048                 ldx #interrupt
70F3 BF010D           (      tests12.asm):00049                 stx irqvec+1
70F6 1CEF             (      tests12.asm):00050                 andcc #$ef              ; enable interrupts
                      (      tests12.asm):00051         
                      (      tests12.asm):00052         ;;; main program
70F8 4F               (      tests12.asm):00053                 clra
70F9                  (      tests12.asm):00054         mainlp: 
70F9 4C               (      tests12.asm):00055                 inca
                      (      tests12.asm):00056         
                      (      tests12.asm):00057                 ;; top line
70FA 8E0400           (      tests12.asm):00058                 ldx #screen
70FD                  (      tests12.asm):00059         l@:     
70FD A780             (      tests12.asm):00060                 sta ,x+
70FF 8C0420           (      tests12.asm):00061                 cmpx #screen+32
7102 26F9             (      tests12.asm):00062                 bne l@
                      (      tests12.asm):00063         
                      (      tests12.asm):00064                 ;; right size
7104 8E043F           (      tests12.asm):00065                 ldx #screen+32+31
7107                  (      tests12.asm):00066         l@:
7107 A784             (      tests12.asm):00067                 sta ,x
7109 308820           (      tests12.asm):00068                 leax 32,x
710C 8C0600           (      tests12.asm):00069                 cmpx #screen+$200
710F 2DF6             (      tests12.asm):00070                 blt l@
                      (      tests12.asm):00071         
                      (      tests12.asm):00072                 ;; bottom line
7111 8E05FF           (      tests12.asm):00073                 ldx #screen+32*15+31
7114                  (      tests12.asm):00074         l@:
7114 A782             (      tests12.asm):00075                 sta ,-x
7116 8C05E0           (      tests12.asm):00076                 cmpx #screen+$1e0
7119 26F9             (      tests12.asm):00077                 bne l@
                      (      tests12.asm):00078         
                      (      tests12.asm):00079                 ;; left side
711B 8E05C0           (      tests12.asm):00080                 ldx #screen+14*32
711E                  (      tests12.asm):00081         l@:
711E A784             (      tests12.asm):00082                 sta ,x
7120 3088E0           (      tests12.asm):00083                 leax -32,x
7123 8C0400           (      tests12.asm):00084                 cmpx #screen
7126 26F6             (      tests12.asm):00085                 bne l@
                      (      tests12.asm):00086         
                      (      tests12.asm):00087                 ;; delay
7128 8E0800           (      tests12.asm):00088                 ldx #2048
712B                  (      tests12.asm):00089         l@:
712B 301F             (      tests12.asm):00090                 leax -1,x
712D 26FC             (      tests12.asm):00091                 bne l@
                      (      tests12.asm):00092         
                      (      tests12.asm):00093                 ;; check if music is finished
712F F671C5           (      tests12.asm):00094                 ldb notdone
7132 26C5             (      tests12.asm):00095                 bne mainlp
7134 17FF36           (      tests12.asm):00096                 lbsr s12_term
7137 39               (      tests12.asm):00097                 rts
                      (      tests12.asm):00098         
     000D             (      tests12.asm):00099         siz:    equ 13
     0002             (      tests12.asm):00100         scn:    equ 2
     0004             (      tests12.asm):00101         crs:    equ 4
     0005             (      tests12.asm):00102         fin:    equ 5
     0006             (      tests12.asm):00103         amp:    equ 6
     0007             (      tests12.asm):00104         srg:    equ 7
     0008             (      tests12.asm):00105         sdt:    equ 8
     0009             (      tests12.asm):00106         dly:    equ 9
     000A             (      tests12.asm):00107         scr:    equ 10
     000C             (      tests12.asm):00108         cpl:    equ 12
                      (      tests12.asm):00109         
7138                  (      tests12.asm):00110         interrupt:
7138 B6FF02           (      tests12.asm):00111                 lda pia0+2              ; ack interrupt
                      (      tests12.asm):00112                 ;; switch screen color
713B B6FF22           (      tests12.asm):00113                 lda pia1+2
713E 8808             (      tests12.asm):00114                 eora #$08
7140 B7FF22           (      tests12.asm):00115                 sta pia1+2
                      (      tests12.asm):00116         
7143 8E71CB           (      tests12.asm):00117                 ldx #voices
7146                  (      tests12.asm):00118         l1@:
7146 10AE02           (      tests12.asm):00119                 ldy scn,x
7149 312F             (      tests12.asm):00120                 leay 15,y
714B 5F               (      tests12.asm):00121                 clrb
714C                  (      tests12.asm):00122         l2@:
714C A685             (      tests12.asm):00123                 lda b,x
714E A7A5             (      tests12.asm):00124                 sta b,y
7150 5C               (      tests12.asm):00125                 incb
7151 C10D             (      tests12.asm):00126                 cmpb #siz
7153 26F7             (      tests12.asm):00127                 bne l2@
7155 300D             (      tests12.asm):00128                 leax siz,x
7157 8C71F2           (      tests12.asm):00129                 cmpx #voiceend
715A 26EA             (      tests12.asm):00130                 bne l1@
                      (      tests12.asm):00131         
715C 7F71C5           (      tests12.asm):00132                 clr notdone
715F 8E71CB           (      tests12.asm):00133                 ldx #voices
7162                  (      tests12.asm):00134         loop@:
7162 6A09             (      tests12.asm):00135                 dec dly,x
7164 2730             (      tests12.asm):00136                 beq next@               ; new note
7166                  (      tests12.asm):00137         continue:       
7166 7C71C5           (      tests12.asm):00138                 inc notdone
7169                  (      tests12.asm):00139         next_voice:     
7169 300D             (      tests12.asm):00140                 leax siz,x
716B 8C71F2           (      tests12.asm):00141                 cmpx #voiceend
716E 26F2             (      tests12.asm):00142                 bne loop@
7170 B671C5           (      tests12.asm):00143                 lda notdone
7173 2618             (      tests12.asm):00144                 bne skip
                      (      tests12.asm):00145                 ;; tear down interrupt
7175 B671C6           (      tests12.asm):00146                 lda old
7178 B7010C           (      tests12.asm):00147                 sta irqvec
717B FC71C7           (      tests12.asm):00148                 ldd old+1
717E FD010D           (      tests12.asm):00149                 std irqvec+1
7181 B671C9           (      tests12.asm):00150                 lda old+3
7184 B7FF01           (      tests12.asm):00151                 sta pia0+1
7187 B671CA           (      tests12.asm):00152                 lda old+4
718A B7FF03           (      tests12.asm):00153                 sta pia0+3
718D                  (      tests12.asm):00154         skip:
                      (      tests12.asm):00155                 ;; switch screen color
718D B6FF22           (      tests12.asm):00156                 lda pia1+2
7190 8808             (      tests12.asm):00157                 eora #$08
7192 B7FF22           (      tests12.asm):00158                 sta pia1+2
7195 3B               (      tests12.asm):00159                 rti
                      (      tests12.asm):00160                 ;; next note
7196                  (      tests12.asm):00161         next@:
7196 10AE0A           (      tests12.asm):00162                 ldy scr,x
7199 A6A0             (      tests12.asm):00163                 lda ,y+
719B 2719             (      tests12.asm):00164                 beq done@               ; no more notes
719D A709             (      tests12.asm):00165                 sta dly,x
719F A606             (      tests12.asm):00166                 lda amp,x               ; set volume
71A1 E6A0             (      tests12.asm):00167                 ldb ,y+
71A3 AD94             (      tests12.asm):00168                 jsr [,x]
71A5 A604             (      tests12.asm):00169                 lda crs,x               ; set coarse tone
71A7 E6A0             (      tests12.asm):00170                 ldb ,y+
71A9 AD94             (      tests12.asm):00171                 jsr [,x]
71AB A605             (      tests12.asm):00172                 lda fin,x               ; set fine tone
71AD E6A0             (      tests12.asm):00173                 ldb ,y+
71AF AD94             (      tests12.asm):00174                 jsr [,x]
71B1 10AF0A           (      tests12.asm):00175                 sty scr,x
71B4 20B0             (      tests12.asm):00176                 bra continue
                      (      tests12.asm):00177                 ;; no more notes
71B6                  (      tests12.asm):00178         done@:
71B6 5F               (      tests12.asm):00179                 clrb
71B7 A604             (      tests12.asm):00180                 lda crs,x
71B9 AD94             (      tests12.asm):00181                 jsr [,x]
71BB A605             (      tests12.asm):00182                 lda fin,x
71BD AD94             (      tests12.asm):00183                 jsr [,x]
71BF A606             (      tests12.asm):00184                 lda amp,x
71C1 AD94             (      tests12.asm):00185                 jsr [,x]
71C3 20A4             (      tests12.asm):00186                 bra next_voice
                      (      tests12.asm):00187         
71C5                  (      tests12.asm):00188         notdone:
71C5                  (      tests12.asm):00189                 rmb 1
71C6                  (      tests12.asm):00190         old:    rmb 5
                      (      tests12.asm):00191         
71CB                  (      tests12.asm):00192         voices:
71CB                  (      tests12.asm):00193         voice0:
71CB 706E             (      tests12.asm):00194                 fdb s12_ctl             ; routine
71CD 0442             (      tests12.asm):00195                 fdb screen+32*2+2
71CF 01               (      tests12.asm):00196                 fcb ay_a_coarse         ; tone coarse
71D0 00               (      tests12.asm):00197                 fcb ay_a_fine           ; tone fine
71D1 08               (      tests12.asm):00198                 fcb ay_a_amp            ; voice amplitude
71D2 03               (      tests12.asm):00199                 fcb psg1&s12_reg
71D3 02               (      tests12.asm):00200                 fcb psg1&s12_dat
71D4                  (      tests12.asm):00201                 rmb 4
71D8                  (      tests12.asm):00202         voice1:
71D8 706E             (      tests12.asm):00203                 fdb s12_ctl             ; routine
71DA 0462             (      tests12.asm):00204                 fdb screen+32*3+2
71DC 03               (      tests12.asm):00205                 fcb ay_b_coarse         ; tone coarse
71DD 02               (      tests12.asm):00206                 fcb ay_b_fine           ; tone fine
71DE 09               (      tests12.asm):00207                 fcb ay_b_amp            ; voice amplitude
71DF 0C               (      tests12.asm):00208                 fcb psg2&s12_reg
71E0 08               (      tests12.asm):00209                 fcb psg2&s12_dat
71E1                  (      tests12.asm):00210                 rmb 4
71E5                  (      tests12.asm):00211         voice2:
71E5 706E             (      tests12.asm):00212                 fdb s12_ctl             ; routine
71E7 0482             (      tests12.asm):00213                 fdb screen+32*4+2
71E9 05               (      tests12.asm):00214                 fcb ay_c_coarse         ; tone coarse
71EA 04               (      tests12.asm):00215                 fcb ay_c_fine           ; tone fine
71EB 0A               (      tests12.asm):00216                 fcb ay_c_amp            ; voice amplitude
71EC 30               (      tests12.asm):00217                 fcb psg3&s12_reg
71ED 20               (      tests12.asm):00218                 fcb psg3&s12_dat
71EE                  (      tests12.asm):00219                 rmb 4
71F2                  (      tests12.asm):00220         voiceend:       
                      (      tests12.asm):00221         
71F2                  (      tests12.asm):00222         scores:
71F2 71F8             (      tests12.asm):00223                 fdb score0
71F4 7210             (      tests12.asm):00224                 fdb score1
71F6 722C             (      tests12.asm):00225                 fdb score2
                      (      tests12.asm):00226                 
71F8                  (      tests12.asm):00227         score0:
71F8 300901AC         (      tests12.asm):00228                 fdb $3009,428
71FC 60000000         (      tests12.asm):00229                 fdb $6000,0
7200 300901AC         (      tests12.asm):00230                 fdb $3009,428
7204 30090153         (      tests12.asm):00231                 fdb $3009,339
7208 3009011D         (      tests12.asm):00232                 fdb $3009,285
720C 00000000         (      tests12.asm):00233                 fdb 0,0
7210                  (      tests12.asm):00234         score1:
7210 30000000         (      tests12.asm):00235                 fdb $3000,0
7214 30090153         (      tests12.asm):00236                 fdb $3009,339
7218 30000000         (      tests12.asm):00237                 fdb $3000,0
721C 30090153         (      tests12.asm):00238                 fdb $3009,339
7220 3009011D         (      tests12.asm):00239                 fdb $3009,285
7224 300900E2         (      tests12.asm):00240                 fdb $3009,226
7228 00000000         (      tests12.asm):00241                 fdb 0,0
722C                  (      tests12.asm):00242         score2:
722C 60000000         (      tests12.asm):00243                 fdb $6000,0
7230 6009011D         (      tests12.asm):00244                 fdb $6009,285
7234 300900E2         (      tests12.asm):00245                 fdb $3009,226
7238 300900BE         (      tests12.asm):00246                 fdb $3009,190
723C 00000000         (      tests12.asm):00247                 fdb 0,0
                      (      tests12.asm):00248         
                      (      tests12.asm):00249                 end start
